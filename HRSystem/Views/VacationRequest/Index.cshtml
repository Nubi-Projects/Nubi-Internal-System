@model IEnumerable<HRSystem.Models.VacationRequest>
@using Microsoft.AspNet.Identity
@{
    ViewBag.Title = "Index";
    HRSystem.Manager.RequestManager mngr = new HRSystem.Manager.RequestManager();
    HRSystem.Manager.Helper helperx = new HRSystem.Manager.Helper();
    var IsArabic = Request.Cookies["culture"].Value == "ar" ? true : false;
    HRSystem.Models.NubiDBEntities Db = new HRSystem.Models.NubiDBEntities();
}


<h2>@Resources.NubiHR.VacationRequests</h2>
<a href="@Url.Action("Create")">@Resources.NubiHR.Create</a>

<nav>
    <div class="nav nav-tabs" id="nav-tab" role="tablist">
        <a class="nav-item nav-link active" id="nav-home-tab" data-toggle="tab" href="#nav-all" role="tab" aria-controls="nav-all" aria-selected="true">@Resources.NubiHR.AllRequests</a>
        <a class="nav-item nav-link" id="nav-profile-tab" data-toggle="tab" href="#nav-approved" role="tab" aria-controls="nav-approved" aria-selected="false">@Resources.NubiHR.ApprovedRequests</a>
        <a class="nav-item nav-link" id="nav-contact-tab" data-toggle="tab" href="#nav-rejected" role="tab" aria-controls="nav-rejected" aria-selected="false">@Resources.NubiHR.RejectedRequests</a>
    </div>
</nav>
<div class="tab-content" id="nav-tabContent">
    <div class="tab-pane fade show active" id="nav-all" role="tabpanel" aria-labelledby="nav-home-tab">
        <br />
        <table id="assets-data-table" class="table table-striped table-bordered table-responsive">
            @if (User.Identity.GetUserId() != null)
            {
                if (@helperx.GetUserRole(User.Identity.GetUserId()) == "المدير العام")
                {
                    <thead>
                        <tr>
                            <th>
                                @Resources.NubiHR.EmployeeName
                            </th>
                            <th>
                                @Resources.NubiHR.RequestDate
                            </th>
                            <th>
                                @Resources.NubiHR.VacationType
                            </th>
                            <th>
                                @Resources.NubiHR.StartDate
                            </th>

                            <th>
                                @Resources.NubiHR.EndDate
                            </th>

                            <th>
                                @Resources.NubiHR.Duration
                            </th>

                            <th>
                                @Resources.NubiHR.ResumeDate
                            </th>

                            <th>
                                @Resources.NubiHR.Address
                            </th>

                            <th>
                                @Resources.NubiHR.AlternativeEmp
                            </th>

                            <th>
                                @Resources.NubiHR.Notes
                            </th>

                            <th>
                                @Resources.NubiHR.Actions
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model.Where(e => e.IsDeleted == false).ToList())
                        {
                            var AlternativeEmpName = Db.Employees.Where(x => x.Id == item.AlternativeEmp).Select(x => x.FirstName + " " + x.LastName).FirstOrDefault();

                            <tr onclick="Edit('@item.Id')">
                                <td>
                                    @Html.DisplayFor(modelItem => item.Employee.FirstName)
                                </td>
                                <td>
                                    @Html.DisplayFor(modelItem => item.RequestDate)
                                </td>
                                <td>
                                    @Html.DisplayFor(modelItem => item.VacationType.Type)
                                </td>
                                <td>
                                    @Html.DisplayFor(modelItem => item.StartDate)
                                </td>
                                <td>
                                    @Html.DisplayFor(modelItem => item.EndDate)
                                </td>

                                <td>
                                    @Html.DisplayFor(modelItem => item.Duration)
                                </td>

                                <td>
                                    @Html.DisplayFor(modelItem => item.ResumeDate)
                                </td>

                                <td>
                                    @Html.DisplayFor(modelItem => item.Address)
                                </td>

                                <td>
                                    @Html.DisplayFor(modelItem => AlternativeEmpName)
                                </td>

                                <td>
                                    @Html.DisplayFor(modelItem => item.Note)
                                </td>
                                @*<td>
                                    @Html.DisplayFor(modelItem => item.IsRejected)
                                </td>*@

                                <td>
                                    @*@Html.ActionLink("تعديل", "Edit", new { id = item.ID }) |*@
                                    @Html.ActionLink(Resources.NubiHR.Details, "Details", new { id = item.Id })
                                </td>
                            </tr>
                        }
                    </tbody>
                }
                else
                {
                    <thead>
                        <tr>
                            <th>
                                @Resources.NubiHR.EmployeeName
                            </th>
                            <th>
                                @Resources.NubiHR.RequestDate
                            </th>
                            <th>
                                @Resources.NubiHR.VacationType
                            </th>
                            <th>
                                @Resources.NubiHR.StartDate
                            </th>

                            <th>
                                @Resources.NubiHR.EndDate
                            </th>

                            <th>
                                @Resources.NubiHR.Duration
                            </th>

                            <th>
                                @Resources.NubiHR.ResumeDate
                            </th>

                            <th>
                                @Resources.NubiHR.Address
                            </th>

                            <th>
                                @Resources.NubiHR.AlternativeEmp
                            </th>

                            <th>
                                @Resources.NubiHR.Notes
                            </th>

                            <th>
                                @Resources.NubiHR.Actions
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model.Where(e => e.IsDeleted == false && e.EmployeeNo == helperx.GetName(User.Identity.GetUserId()).Employee.Id).ToList())
                        {
                            var AlternativeEmpName = Db.Employees.Where(x => x.Id == item.AlternativeEmp).Select(x => x.FirstName + " " + x.LastName).FirstOrDefault();

                            <tr onclick="Edit('@item.Id')">
                                <td>
                                    @Html.DisplayFor(modelItem => item.Employee.FirstName)
                                </td>
                                <td>
                                    @Html.DisplayFor(modelItem => item.RequestDate)
                                </td>
                                <td>
                                    @Html.DisplayFor(modelItem => item.VacationType.Type)
                                </td>
                                <td>
                                    @Html.DisplayFor(modelItem => item.StartDate)
                                </td>
                                <td>
                                    @Html.DisplayFor(modelItem => item.EndDate)
                                </td>

                                <td>
                                    @Html.DisplayFor(modelItem => item.Duration)
                                </td>

                                <td>
                                    @Html.DisplayFor(modelItem => item.ResumeDate)
                                </td>

                                <td>
                                    @Html.DisplayFor(modelItem => item.Address)
                                </td>

                                <td>
                                    @Html.DisplayFor(modelItem => AlternativeEmpName)

                                </td>

                                <td>
                                    @Html.DisplayFor(modelItem => item.Note)
                                </td>


                                <td>
                                    @*@Html.ActionLink("تعديل", "Edit", new { id = item.ID }) |*@
                                    @Html.ActionLink(Resources.NubiHR.Details, "Details", new { id = item.Id }) 
                                    @if(DateTime.Now.AddDays(1) < item.StartDate)
                                    {
                                        <text> | </text> @Html.ActionLink(Resources.NubiHR.Delete, "Delete", new { id = item.Id })
                                    }
                                    else
                                    {

                                    }
                                </td>
                            </tr>
                        }
                    </tbody>
                }
            }
        </table>
    </div>
    <div class="tab-pane fade" id="nav-approved" role="tabpanel" aria-labelledby="nav-profile-tab">
        <br />
        <table id="assets-data-table1" class="table table-striped table-bordered table-responsive">
            @if (User.Identity.GetUserId() != null)
            {
                if (@helperx.GetUserRole(User.Identity.GetUserId()) == "المدير العام")
                {
                    <thead>
                        <tr>
                            <th>
                                @Resources.NubiHR.EmployeeName
                            </th>
                            <th>
                                @Resources.NubiHR.RequestDate
                            </th>
                            <th>
                                @Resources.NubiHR.VacationType
                            </th>
                            <th>
                                @Resources.NubiHR.StartDate
                            </th>

                            <th>
                                @Resources.NubiHR.EndDate
                            </th>

                            <th>
                                @Resources.NubiHR.Duration
                            </th>

                            <th>
                                @Resources.NubiHR.ResumeDate
                            </th>

                            <th>
                                @Resources.NubiHR.Address
                            </th>

                            <th>
                                @Resources.NubiHR.AlternativeEmp
                            </th>

                            <th>
                                @Resources.NubiHR.Notes
                            </th>

                            <th>
                                @Resources.NubiHR.Actions
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model.Where(e => e.IsDeleted == false && e.ManagerApprovement == true).ToList())
                        {
                            var AlternativeEmpName = Db.Employees.Where(x => x.Id == item.AlternativeEmp).Select(x => x.FirstName + " " + x.LastName).FirstOrDefault();

                            <tr onclick="Edit('@item.Id')">
                                <td>
                                    @Html.DisplayFor(modelItem => item.Employee.FirstName)
                                </td>
                                <td>
                                    @Html.DisplayFor(modelItem => item.RequestDate)
                                </td>
                                <td>
                                    @Html.DisplayFor(modelItem => item.VacationType.Type)
                                </td>
                                <td>
                                    @Html.DisplayFor(modelItem => item.StartDate)
                                </td>
                                <td>
                                    @Html.DisplayFor(modelItem => item.EndDate)
                                </td>

                                <td>
                                    @Html.DisplayFor(modelItem => item.Duration)
                                </td>

                                <td>
                                    @Html.DisplayFor(modelItem => item.ResumeDate)
                                </td>

                                <td>
                                    @Html.DisplayFor(modelItem => item.Address)
                                </td>

                                <td>
                                    @Html.DisplayFor(modelItem => AlternativeEmpName)
                                </td>

                                <td>
                                    @Html.DisplayFor(modelItem => item.Note)
                                </td>
                                @*<td>
                                    @Html.DisplayFor(modelItem => item.IsRejected)
                                </td>*@

                                <td>
                                    @*@Html.ActionLink("تعديل", "Edit", new { id = item.ID }) |*@
                                    @Html.ActionLink(Resources.NubiHR.Details, "Details", new { id = item.Id })
                                </td>
                            </tr>
                        }
                    </tbody>
                }
                else
                {
                    <thead>
                        <tr>
                            <th>
                                @Resources.NubiHR.EmployeeName
                            </th>
                            <th>
                                @Resources.NubiHR.RequestDate
                            </th>
                            <th>
                                @Resources.NubiHR.VacationType
                            </th>
                            <th>
                                @Resources.NubiHR.StartDate
                            </th>

                            <th>
                                @Resources.NubiHR.EndDate
                            </th>

                            <th>
                                @Resources.NubiHR.Duration
                            </th>

                            <th>
                                @Resources.NubiHR.ResumeDate
                            </th>

                            <th>
                                @Resources.NubiHR.Address
                            </th>

                            <th>
                                @Resources.NubiHR.AlternativeEmp
                            </th>

                            <th>
                                @Resources.NubiHR.Notes
                            </th>

                            <th>
                                @Resources.NubiHR.Actions
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model.Where(e => e.IsDeleted == false && e.EmployeeNo == helperx.GetName(User.Identity.GetUserId()).Employee.Id && e.ManagerApprovement == true).ToList())
                        {
                            var AlternativeEmpName = Db.Employees.Where(x => x.Id == item.AlternativeEmp).Select(x => x.FirstName + " " + x.LastName).FirstOrDefault();

                            <tr onclick="Edit('@item.Id')">
                                <td>
                                    @Html.DisplayFor(modelItem => item.Employee.FirstName)
                                </td>
                                <td>
                                    @Html.DisplayFor(modelItem => item.RequestDate)
                                </td>
                                <td>
                                    @Html.DisplayFor(modelItem => item.VacationType.Type)
                                </td>
                                <td>
                                    @Html.DisplayFor(modelItem => item.StartDate)
                                </td>
                                <td>
                                    @Html.DisplayFor(modelItem => item.EndDate)
                                </td>

                                <td>
                                    @Html.DisplayFor(modelItem => item.Duration)
                                </td>

                                <td>
                                    @Html.DisplayFor(modelItem => item.ResumeDate)
                                </td>

                                <td>
                                    @Html.DisplayFor(modelItem => item.Address)
                                </td>

                                <td>
                                    @Html.DisplayFor(modelItem => AlternativeEmpName)

                                <td>
                                    @Html.DisplayFor(modelItem => item.Note)
                                </td>


                                <td>
                                    @*@Html.ActionLink("تعديل", "Edit", new { id = item.ID }) |*@
                                    @Html.ActionLink(Resources.NubiHR.Details, "Details", new { id = item.Id })
                                    @if (DateTime.Now.AddDays(1) < item.StartDate)
                                    {
                                        <text> | </text> @Html.ActionLink(Resources.NubiHR.Delete, "Delete", new { id = item.Id })
                                    }
                                    else
                                    {

                                    }
                                </td>
                            </tr>
                        }
                    </tbody>
                }
            }
        </table>
    </div>
    <div class="tab-pane fade" id="nav-rejected" role="tabpanel" aria-labelledby="nav-contact-tab">
        <br />
        <table id="assets-data-table2" class="table table-striped table-bordered table-responsive">
            @if (User.Identity.GetUserId() != null)
            {
                if (@helperx.GetUserRole(User.Identity.GetUserId()) == "المدير العام")
                {
                    <thead>
                        <tr>
                            <th>
                                @Resources.NubiHR.EmployeeName
                            </th>
                            <th>
                                @Resources.NubiHR.RequestDate
                            </th>
                            <th>
                                @Resources.NubiHR.VacationType
                            </th>
                            <th>
                                @Resources.NubiHR.StartDate
                            </th>

                            <th>
                                @Resources.NubiHR.EndDate
                            </th>

                            <th>
                                @Resources.NubiHR.Duration
                            </th>

                            <th>
                                @Resources.NubiHR.ResumeDate
                            </th>

                            <th>
                                @Resources.NubiHR.Address
                            </th>

                            <th>
                                @Resources.NubiHR.AlternativeEmp
                            </th>

                            <th>
                                @Resources.NubiHR.Notes
                            </th>

                            <th>
                                @Resources.NubiHR.Actions
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model.Where(e => e.IsDeleted == false && e.IsRejected == true).ToList())
                        {
                            var AlternativeEmpName = Db.Employees.Where(x => x.Id == item.AlternativeEmp).Select(x => x.FirstName + " " + x.LastName).FirstOrDefault();

                            <tr onclick="Edit('@item.Id')">
                                <td>
                                    @Html.DisplayFor(modelItem => item.Employee.FirstName)
                                </td>
                                <td>
                                    @Html.DisplayFor(modelItem => item.RequestDate)
                                </td>
                                <td>
                                    @Html.DisplayFor(modelItem => item.VacationType.Type)
                                </td>
                                <td>
                                    @Html.DisplayFor(modelItem => item.StartDate)
                                </td>
                                <td>
                                    @Html.DisplayFor(modelItem => item.EndDate)
                                </td>

                                <td>
                                    @Html.DisplayFor(modelItem => item.Duration)
                                </td>

                                <td>
                                    @Html.DisplayFor(modelItem => item.ResumeDate)
                                </td>

                                <td>
                                    @Html.DisplayFor(modelItem => item.Address)
                                </td>

                                <td>
                                    @Html.DisplayFor(modelItem => AlternativeEmpName)
                                </td>

                                <td>
                                    @Html.DisplayFor(modelItem => item.Note)
                                </td>
                                @*<td>
                                    @Html.DisplayFor(modelItem => item.IsRejected)
                                </td>*@

                                <td>
                                    @*@Html.ActionLink("تعديل", "Edit", new { id = item.ID }) |*@
                                    @Html.ActionLink(Resources.NubiHR.Details, "Details", new { id = item.Id })
                                </td>
                            </tr>
                        }
                    </tbody>
                }
                else
                {
                    <thead>
                        <tr>
                            <th>
                                @Resources.NubiHR.EmployeeName
                            </th>
                            <th>
                                @Resources.NubiHR.RequestDate
                            </th>
                            <th>
                                @Resources.NubiHR.VacationType
                            </th>
                            <th>
                                @Resources.NubiHR.StartDate
                            </th>

                            <th>
                                @Resources.NubiHR.EndDate
                            </th>

                            <th>
                                @Resources.NubiHR.Duration
                            </th>

                            <th>
                                @Resources.NubiHR.ResumeDate
                            </th>

                            <th>
                                @Resources.NubiHR.Address
                            </th>

                            <th>
                                @Resources.NubiHR.AlternativeEmp
                            </th>

                            <th>
                                @Resources.NubiHR.Notes
                            </th>

                            <th>
                                @Resources.NubiHR.Actions
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model.Where(e => e.IsDeleted == false && e.EmployeeNo == helperx.GetName(User.Identity.GetUserId()).Employee.Id && e.IsRejected == true).ToList())
                        {
                            var AlternativeEmpName = Db.Employees.Where(x => x.Id == item.AlternativeEmp).Select(x => x.FirstName + " " + x.LastName).FirstOrDefault();

                            <tr onclick="Edit('@item.Id')">
                                <td>
                                    @Html.DisplayFor(modelItem => item.Employee.FirstName)
                                </td>
                                <td>
                                    @Html.DisplayFor(modelItem => item.RequestDate)
                                </td>
                                <td>
                                    @Html.DisplayFor(modelItem => item.VacationType.Type)
                                </td>
                                <td>
                                    @Html.DisplayFor(modelItem => item.StartDate)
                                </td>
                                <td>
                                    @Html.DisplayFor(modelItem => item.EndDate)
                                </td>

                                <td>
                                    @Html.DisplayFor(modelItem => item.Duration)
                                </td>

                                <td>
                                    @Html.DisplayFor(modelItem => item.ResumeDate)
                                </td>

                                <td>
                                    @Html.DisplayFor(modelItem => item.Address)
                                </td>

                                <td>
                                    @Html.DisplayFor(modelItem => AlternativeEmpName)
                                </td>

                                <td>
                                    @Html.DisplayFor(modelItem => item.Note)
                                </td>


                                <td>
                                    @*@Html.ActionLink("تعديل", "Edit", new { id = item.ID }) |*@
                                    @Html.ActionLink(Resources.NubiHR.Details, "Details", new { id = item.Id })
                                </td>
                            </tr>
                        }
                    </tbody>
                }
            }
        </table>
    </div>



</div>
<script>
    function Edit(itemid) {

        window.location.href = "/VacationRequest/Edit/" + itemid;
    }
</script>

